
# 驾驶网页游戏详细产品需求

## 1. 设备兼容性与操作适配

### 1.1 移动端优先

* 游戏应针对手机端做适配，尤其是竖屏体验。页面、按钮、操作布局都应考虑单手拇指操作习惯。
* 支持横屏模式但以竖屏为主。

### 1.2 桌面端兼容

* 电脑端可用WASD或箭头键进行所有车辆操作。
* 鼠标仅用于菜单、选人、选车等非驾驶功能。

---

## 2. 操控系统与交互方式

### 2.1 虚拟摇杆控制（Mobile）

* 屏幕下方显示单手操作的虚拟摇杆，支持上下左右。
* **上/下**：油门和刹车，**左/右**：转向。
* 推荐集成 [nipplejs](https://yoannmoinet.github.io/nipplejs/) 或 joy.js 实现。
* 摇杆需流畅灵敏，防抖，且点击范围适配不同机型。

### 2.2 转向灯控制

* 摇杆旁放两个明显的“左转向灯”、“右转向灯”按钮，单手可点击，状态可切换（开/关）。
* 按钮带闪烁动画，车辆两侧有同步闪烁效果。

### 2.3 桌面端操作

* WASD 或箭头键控制油门、刹车、转向。
* Q/E或Z/C键控制左/右转向灯，转向灯状态可用小图标或灯光表现。

---

## 3. 用户系统与登录入口

### 3.1 用户登录

* 游戏初始必须登录：允许输入用户名昵称，也可以用Google一键登录（OAuth2，建议Firebase Authentication）。
* 登录信息本地存储，用于保存分数、偏好设置、皮肤、付费记录等。

### 3.2 用户数据

* 账号支持扩展头像、皮肤、历史成绩、购买道具、广告个性化配置等。

---

## 4. 角色与车辆

### 4.1 卡通角色

* 至少内置3个卡通人物模型，风格可爱，支持后续付费/成就解锁更多角色。
* 角色坐在车内副驾或主驾，动作丰富，可有简单表情或指令动作。

### 4.2 车辆选择

* 至少3辆风格各异的卡通车辆（小车、面包车、SUV等），可换皮肤。
* 车辆性能参数可微调，如加速、最高速、操控手感。
* 后续可拓展稀有车辆、品牌联名等付费内容。

### 4.3 选择界面

* 登录后有简单角色、车辆选择界面，模型实时预览。

---

## 5. 场景与地图

### 5.1 基础道路

* 初版地图为一条宽直道，支持单车自由来回行驶。
* 地面有基础路面贴图，简单路沿、绿化、分道线。

### 5.2 建筑与广告

* 道路两侧有楼房、商铺等建筑模型。
* 部分建筑侧墙预留矩形广告位（可后续上传图片/视频），位置固定但内容可动态替换。

### 5.3 红绿灯与路标

* 地图有至少一个带三色灯的路口，红黄绿切换带有真实时序，信号灯与路口绑定。
* 路口和道路两侧放置常见德国路标（限速、让行、禁止转弯等）。
* 路标、红绿灯支持配置化，便于后续自动化生成。

### 5.4 高级地图与扩展

* 后续可自动导入真实地图（如OpenStreetMap），并生成城市、高速路、郊区等场景。
* 不同地图可自动加载当地路牌与法规。

---

## 6. 驾驶规则与行为检测

### 6.1 实时测速

* 屏幕HUD（抬头显示）实时显示当前速度，单位支持km/h与mph切换。
* 超速时以动画或高亮警告提示，扣分。

### 6.2 驾驶行为检测

* 监控以下行为：

  * 闯红灯（红灯驶入路口）
  * 超速
  * 不打灯变道/转弯
  * 压线、逆行、违规掉头
* 违规时在屏幕显眼位置扣分提示，计入总成绩。

### 6.3 考官提示与评分

* AI考官角色（副驾）通过弹窗、对话框或语音提示路线/下步指令。
* 每轮驾驶结束后出具成绩与错误反馈，保存历史最佳分数。

---

## 7. 交通元素

### 7.1 AI车辆

* 随机生成少量AI车辆，自动巡航或停在红灯前。
* 简单避让/跟随逻辑，碰撞后有动画或提示。

### 7.2 行人、自行车

* 路口、斑马线随机出现行人或自行车，简单横穿动作，增强场景真实性。

---

## 8. 摄像机与视角

### 8.1 固定跟随

* 默认摄像机位于车辆后上方，第三人称视角（近似马里奥赛车），转弯、加速时自动平滑跟随。

### 8.2 视角切换

* 预留“切换视角”按钮，允许玩家选前车、车内等其他视角。

---

## 9. 广告与付费系统

### 9.1 广告位

* 支持后端或配置文件动态指定建筑广告内容（图片/短视频），广告点击可跳转链接。
* 日志记录广告点击/曝光行为，为商业化做准备。

### 9.2 付费内容

* 预留皮肤、角色、车辆、道具、广告关闭等付费解锁功能接口，后续可接Stripe、微信支付等主流支付SDK。

---

## 10. 多人在线扩展（后续）

* 游戏代码结构需预留多人在线扩展接口，如Socket.io/PeerJS房间、玩家状态同步接口等。
* 允许未来多人同屏比拼或“驾考对战”模式上线。

---

## 11. 资源与配置管理

### 11.1 文件结构

* 资源分类管理：models（模型）、textures（贴图）、audio（音效）、ads（广告）、config（配置文件）等。
* 所有地图、车辆、角色、广告、路标、红绿灯等元素全部配置化，便于扩展/自动化生成。

### 11.2 法规与多语言

* 各国法规、标志、红绿灯规则、测速等内容全部用JSON/YAML可配置，便于后期一键切换/自动加载多国版本。
* 文本、提示、语音均支持多语言，支持切换。

---

## 12. 性能与易用性

* 保证在主流手机机型、Chrome/Safari等浏览器60fps平稳运行。
* 加载、切换、反馈需流畅不卡顿，主要界面5秒内可进入游戏。
* 支持断线重连，意外退出后自动恢复进度。

---



驾驶网页游戏技术需求文档
1. 前端开发技术
1.1 渲染引擎与核心库

    Three.js：实现3D场景、车辆、角色、建筑、道路、红绿灯、广告牌等的渲染。

    Cannon.js（或Ammo.js）：实现基础物理碰撞、车辆行驶动力学、简单AI车辆与障碍物物理响应。

    UI 框架：推荐Vue.js，用于页面、菜单、HUD、登录、选人/选车等UI部分。

1.2 适配与响应式

    移动端适配：使用CSS媒体查询、viewport自适应、rem布局等，兼容主流iOS/Android设备，优先支持竖屏。

    虚拟摇杆：集成nipplejs或joy.js等虚拟摇杆库，实现触控单手控制。

    PC端支持：监听键盘事件，实现WASD或箭头键控制，保证桌面端无缝切换体验。

1.3 HUD与交互

    实现实时速度、违规提示、分数反馈、考官指令、转向灯状态等信息的可视化。

    支持HUD自适应大小和位置，避免遮挡驾驶画面。

2. 用户认证与账号体系
2.1 登录与认证

    Firebase Authentication（或其他OAuth平台）：

        支持Google账号一键登录。

        支持游客模式（仅昵称），但部分功能需账号绑定。

    Session管理：前端本地存储用户Session/Token，实现自动登录与断线恢复。

2.2 用户数据

    存储用户基本信息（昵称、头像、选车、选人、成绩、积分、解锁内容等）。

    为未来接入云存储（如Firebase Realtime Database或Firestore）预留API接口。

3. 资源管理与配置
3.1 资源文件组织

    所有3D模型使用gltf/glb标准格式，贴图为png/jpg/webp，音效为ogg/mp3。

    资源分文件夹管理（models、textures、audio、ads、config）。

3.2 配置化与可扩展

    所有地图、道路、路标、红绿灯、车辆、角色等元素均以JSON/YAML格式配置，可动态加载。

    不同国家/城市规则配置分开管理，支持热切换与远程配置。

    广告位内容支持后端接口动态推送。

4. 业务核心功能模块
4.1 车辆控制与物理

    基于Cannon.js实现简化的车辆动力学与轮胎摩擦。

    支持油门、刹车、倒车、左右转向、转向灯控制与物理表现。

    转向灯动画与HUD同步。

4.2 场景渲染

    动态加载场景（道路、建筑、绿化带、广告牌）。

    红绿灯与路标按配置自动布置，红绿灯采用状态机定时切换。

    支持后期自动导入OpenStreetMap数据生成地图。

4.3 行为检测与评分

    实时检测玩家驾驶状态：

        是否闯红灯、是否打灯、是否超速、是否违规变道等。

    扣分和错误提示实时反馈到HUD。

    驾驶行为检测模块可配置规则，便于后续适配其他国家法规。

4.4 AI交通

    实现AI车辆、行人、自行车等动态交通元素。

    AI车辆具备基础避障、跟随、停车、红绿灯响应等能力。

    AI元素可配置密度和行为参数。

5. 广告与付费系统（预留）
5.1 广告管理

    广告资源可远程配置或动态推送，支持图片、GIF、视频广告，格式自适应。

    支持广告点击日志收集，为商业分析做准备。

    广告位与场景解耦，可灵活增删。

5.2 付费系统

    预留接入Stripe、Google Pay、Apple Pay、微信/支付宝等支付SDK的API接口。

    用户付费数据与账号体系绑定，支持虚拟道具、车辆、角色皮肤、去广告等内容。

6. 多人在线（后续扩展）

    预留WebSocket（如Socket.io）或PeerJS接口与模块，便于未来上线多人实时互动。

    代码中所有玩家与状态数据封装为可同步数据结构。

    服务器推荐Node.js，必要时云服务（如Firebase、AWS或自建VPS）。

7. 性能优化与安全
7.1 前端性能

    支持懒加载、资源压缩与合并、场景分块加载。

    移动端目标30-60fps，资源包最大不超15MB（首屏不超5MB）。

    大模型、贴图通过CDN分发。

7.2 安全

    登录、用户数据、广告接口均为HTTPS。

    前端关键操作防篡改，重要数据后端校验。

    防止作弊：基础行为检测（如速度hack检测）、分数/成就服务器校验。

8. 国际化与本地化

    所有UI、提示、考官语音等支持多语言，文本与音频分资源包存储。

    国家法规、地图、路标、单位（km/h或mph）等随国家配置自动切换。

9. 测试与兼容性

    必须在主流手机、平板、PC浏览器（Chrome、Safari、Edge、Firefox）多端测试。

    响应式设计保证不同分辨率和系统适配。

    持续集成工具（如Github Actions）支持自动打包与基本自动化测试。

10. 代码规范与协作

    采用ESLint/Prettier统一前端代码风格，TypeScript优先。

    采用模块化开发，组件复用，功能解耦。

    代码、资源和配置文档同步维护，接口和数据结构有说明文档。

